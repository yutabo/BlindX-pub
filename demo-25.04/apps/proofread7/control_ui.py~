import gradio as gr
from pathlib import Path

def run_proofreader(input_dir, output_dir, hotwords_text):
    # æ ¡æ­£å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤
    input_path = Path(input_dir)
    output_path = Path(output_dir)
    hotwords = hotwords_text.strip().split()

    if not input_path.exists():
        return "âŒ å…¥åŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã›ã‚“"
    if not output_path.exists():
        output_path.mkdir(parents=True)

    # æ ¡æ­£ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã«å·®ã—æ›¿ãˆï¼‰
    from myproofreader import Proofreader  # ä»®ã®import
    pf = Proofreader(hotwords=hotwords)
    for file in input_path.glob("*.txt"):
        result = pf.process(file.read_text())
        output_file = output_path / file.name
        output_file.write_text(result)

    return f"âœ… æ ¡æ­£å®Œäº†: {len(list(input_path.glob('*.txt')))} ä»¶å‡¦ç†ã—ã¾ã—ãŸ"

# Gradio UIæ§‹æˆ
with gr.Blocks() as app:
    gr.Markdown("### ğŸ“˜ æ ¡æ­£ãƒ„ãƒ¼ãƒ« Web UI")
    
    input_dir = gr.Textbox(label="å…¥åŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹")
    output_dir = gr.Textbox(label="å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹")
    hotwords = gr.Textbox(label="HOTWORDSï¼ˆã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šï¼‰")
    run_button = gr.Button("æ ¡æ­£ã‚¹ã‚¿ãƒ¼ãƒˆ")

    result = gr.Textbox(label="å‡¦ç†çµæœãƒ­ã‚°")

    run_button.click(fn=run_proofreader,
                     inputs=[input_dir, output_dir, hotwords],
                     outputs=result)

app.launch()
